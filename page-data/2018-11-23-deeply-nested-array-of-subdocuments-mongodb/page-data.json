{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018-11-23-deeply-nested-array-of-subdocuments-mongodb/","result":{"data":{"site":{"id":"Site","siteMetadata":{"title":"Stephen Knutter"}},"markdownRemark":{"id":"13c07d1c-b21c-5b3d-a2dd-fcbd856e1714","excerpt":"Example mongodb document Use mongodb aggregation to access categories -> items -> name and return the embedded document assuming our database has a collectionâ€¦","html":"<p>Example mongodb document</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">    <span class=\"token punctuation\">{</span>\n        _id<span class=\"token operator\">:</span> <span class=\"token function\">ObjectID</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"4b1bb6ff3abc8266a21890co\"</span><span class=\"token punctuation\">)</span>\n        listing<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            name<span class=\"token operator\">:</span> <span class=\"token string\">\"foo\"</span>\n            address<span class=\"token operator\">:</span> <span class=\"token string\">\"ham street\"</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        categories<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">{</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"bar\"</span>\n                items<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token punctuation\">{</span>\n                        name<span class=\"token operator\">:</span> <span class=\"token string\">\"eggs\"</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">{</span>\n                title<span class=\"token operator\">:</span> <span class=\"token string\">\"baz\"</span>\n                items<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                    <span class=\"token punctuation\">{</span>\n                        name<span class=\"token operator\">:</span> <span class=\"token string\">\"french toast\"</span>\n                    <span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>Use mongodb <a href=\"https://docs.mongodb.com/manual/core/aggregation-pipeline/index.html\">aggregation</a> to access categories -> items -> name and return the embedded document</p>\n<p>assuming our database has a collection named <code class=\"language-text\">listings</code> and looking for item names that have the word <code class=\"language-text\">french</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">db<span class=\"token punctuation\">.</span>listings<span class=\"token punctuation\">.</span><span class=\"token function\">aggregate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n    \n    <span class=\"token comment\">/* Make $match &amp; $sort first in aggregation pipelines to take advantage of indexes */</span>\n    <span class=\"token punctuation\">{</span> $match<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"categories.items.name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>$regex<span class=\"token operator\">:</span> <span class=\"token string\">\"french\"</span><span class=\"token punctuation\">,</span> $options<span class=\"token operator\">:</span> <span class=\"token string\">\"i\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> $unwind<span class=\"token operator\">:</span> <span class=\"token string\">\"$categories\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> $unwind<span class=\"token operator\">:</span> <span class=\"token string\">\"$categories.items\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> $limit<span class=\"token operator\">:</span> <span class=\"token number\">5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> $project<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>_id<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> item<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">\"$categories.items.name\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/\">$unwind</a> both arrays <code class=\"language-text\">categories</code> and <code class=\"language-text\">items</code> which essentialy creates new documents.</p>\n<p>From there, <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/project/\">$project</a> any property of the document.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n    item<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        name<span class=\"token operator\">:</span> <span class=\"token string\">\"french toast\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"Access Deeply Nested Array of Subdocuments in Mongodb","date":"November 23, 2018","description":"Access a deeply nested array of subdocuments in mongodb utilizing the aggregation pipeline","geo":null}}},"pageContext":{"slug":"/2018-11-23-deeply-nested-array-of-subdocuments-mongodb/","previous":{"fields":{"slug":"/2018-05-12-docker-commands/"},"frontmatter":{"title":"A List of Helpful Docker Commands"}},"next":{"fields":{"slug":"/2019-01-26-install-mongodb-on-mac/"},"frontmatter":{"title":"Installing Mongodb on a Mac"}}}}}